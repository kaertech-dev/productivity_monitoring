<!-- Filter and Download Section -->
<div class="mb-3">
    <div class="d-flex justify-content-between align-items-center">
        <!-- Filter on left -->
        <div class="d-flex align-items-center gap-2">
            <label for="arrowDropdown" class="fw-bold">Choose Filter:</label>
            <div class="dropdown">
                <button class="btn btn-secondary dropdown-toggle" type="button" id="arrowDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                </button>
            <!--dropdown forms-->
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="arrowDropdown">
                <li><a class="dropdown-item" href="#" data-target="#dayform">Day</a></li>
                <li><a class="dropdown-item" href="#" data-target="#weekform">Week</a></li>
                <li><a class="dropdown-item" href="#" data-target="#monthform">Month</a></li>
                <li><a class="dropdown-item" href="#" data-target="#rangeform">Range</a></li>
            </ul>
            </div>
            <div id="spinner" class="spinner-border text-primary" role="status" style="display: none;">
                <span class="visually-hidden">loading...</span>
            </div>
        </div>
        
        <!-- Download Button on right -->
        <div>
            <a href="/download-csv" class="btn btn-success">
                ⬇️ Download CSV
            </a>
        </div>
    </div>
    
    <!-- Form container that pushes content down -->
    <div id="form-container" style="display: none; margin-top: 1rem;">
        <!--week form-->
        <form id="weekform" style="display: none;">
            <label for="week">Select week:</label>
            <input type="week" id="week" name="week" required>
            <button type="submit" style="border-style: solid; border-width: 1px; border-color: #ccc;">Submit</button>
        </form>

        <!--month form-->
        <form id="monthform" style="display: none;">
            <label for="month">Select month:</label>
            <input type="month" id="month" name="month" required>
            <button type="submit" style="border-style: solid; border-width: 1px; border-color: #ccc;">Submit</button>
        </form>

        <!--day form-->
        <form id="dayform" style="display: none;">
            <label for="day" style="font-weight: bold;">Select day:</label>
            <input type="date" id="day" name="day" required>
            <button type="submit" style="border-style: solid; border-width: 1px; border-color: #ccc;">Submit</button>
        </form>

        <!--range date-->
        <form id="rangeform">
            <label>Start Date: 
                <input type="date" class="action-start" name="start_date" value="{{ current_date.split(' → ')[0] }}">
            </label>
            <label>End Date: 
                <input type="date" class="action-end" name="end_date" value="{{ current_date.split(' → ')[1] if '→' in current_date else current_date }}">
            </label>
            <button type="submit" class="action-btn filter-btn" style="border-style: solid; border-width: 1px; border-color: #ccc;">Filter</button>
        </form>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
const formContainer = document.getElementById("form-container");
const dropdownItems = document.querySelectorAll(".dropdown-item");

// Show the selected form
dropdownItems.forEach(item => {
    item.addEventListener("click", function (e) {
    e.preventDefault();
    const targetId = this.getAttribute("data-target");
    const forms = formContainer.querySelectorAll("form");
    forms.forEach(form => form.style.display = "none");
    document.querySelector(targetId).style.display = "block";
    formContainer.style.display = "block";
    });
});

// Attach submit handlers to each form
const forms = formContainer.querySelectorAll("form");
forms.forEach(form => {
    form.addEventListener("submit", function (e) {
    e.preventDefault();

    let query = "";

    if (form.id === "dayform") {
        const day = form.querySelector("#day").value;
        query = `?day=${encodeURIComponent(day)}`;
    } else if (form.id === "weekform") {
        const week = form.querySelector("#week").value;
        query = `?week=${encodeURIComponent(week)}`;
    } else if (form.id === "monthform") {
        const month = form.querySelector("#month").value;
        query = `?month=${encodeURIComponent(month)}`;
    } else if (form.id === "rangeform") {
        const start = form.querySelector(".action-start").value;
        const end = form.querySelector(".action-end").value;
        query = `?start_date=${encodeURIComponent(start)}&end_date=${encodeURIComponent(end)}`;
    }

    window.location.href = `/${query}`;
    });
});
});
</script>