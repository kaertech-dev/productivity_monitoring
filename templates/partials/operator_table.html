<!--APP/app/templates/partials/operator_table.html-->
<div class="table-responsive">
    <table class="table table-striped table-bordered">
        <thead class="bg-success text-white">
            <tr>
                {% for col in columns %}
                    <th>{{ col }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for operator, records in groups.items() %}
            {% for record in records %}
                {% set is_last_in_group = loop.last %}
                {% set row_index = loop.index %}
                <tr>
                    {% if loop.first %}
                        <td rowspan="{{ records|length }}">{{ record.operator_en }}</td>
                    {% endif %}
                    
                    <!-- Customer column with rowspan -->
                    {% if record.Customer_rowspan > 0 %}
                        <td rowspan="{{ record.Customer_rowspan }}">
                            {{ record.Customer }}
                        </td>
                    {% endif %}

                    <!-- Model column with rowspan -->
                    {% if record.Model_rowspan > 0 %}
                        <td rowspan="{{ record.Model_rowspan }}">
                            {{ record.Model }}
                        </td>
                    {% endif %}
                    
                    <td>{{ record.Station }}</td>
                    <td>{{ record.Output }}</td>
                    <td>{{ record.Target_Time }}</td>
                    <td>{{ record.Cycle_Time }}</td>
                    <td>{{ record.Start_Time }}</td>
                    <td>{{ record.End_time }}</td>
                    <td>{{ record['%UTIL'] }}</td>
                    
                    {% if loop.first %}
                        <td rowspan="{{ records|length }}">{{ summaries.get(operator, {}).get("%UTIL", 0) }}</td>
                    {% endif %}
                </tr>
            {% endfor %}
            {% endfor %}
            
            {% if summaries.get("__AVERAGE__") %}
            <tr class="table-secondary fw-bold">
                <td colspan="10" style="text-align:right;">Average Productivity for ({{ current_date }})</td>
                <td>{{ summaries["__AVERAGE__"]["%UTIL"] }}</td>
            </tr>
            {% endif %}
        </tbody>
    </table>
</div>